# Сервис для работы с балансом пользователей

# Сервис реализован на Java с использованием фреймворка Spring Boot и предоставляет HTTP API для взаимодействия с балансом пользователей.

## Инструкция по запуску
### Для запуска приложения с помощью Maven, необходимо выполнить следующие команды в командной строке:

* git clone https://github.com/arsproger/spring-boot-transaction-service.git
* cd project_name
* mvn spring-boot:run
* После запуска приложения, API будет доступно по адресу http://localhost:8080.

# Основное задание
## Реализовал следующие методы для работы с балансом пользователей:

### Метод начисления средств на баланс

* POST /operation/replenishment?userId={userId}&amount={amount}
* Принимает id пользователя и сколько средств зачислить.

### Метод резервирования средств с основного баланса на отдельном счете

* POST /operation/reserving?userId={userId}&productId={productId}
* Принимает id пользователя и id услуги (заказ создается автоматически, а стоимость берется из самой услуги.)

### Метод признания выручки

* POST /operation/revenue-recognition?orderId={orderId)
* Списывает из резерва деньги, добавляет данные в отчет для бухгалтерии - Принимает id заказа

### Метод получения баланса пользователя

* GET /user/{id}
* Принимает id пользователя.

## Дополнительные задания
### Доп. Задание 1: Месячный отчет по заказам
* Также реализовал метод для получения месячного отчета по заказам, который бухгалтерия запрашивает раз в месяц:

* GET /operation/monthly-order-report?year={year}&month={month}
* На входе метод принимает год и месяц отчетного периода в формате YYYY-MM. 
* На выходе генерируется CSV файл со сводным отчетом по всем пользователям, с указанием сумм выручки по каждой из предоставленной услуги

### Доп. Задание 2: Список транзакций
* Наконец, предоставляю метод для получения списка транзакций с комментариями откуда и зачем были начислены/списаны средства с баланса:

* GET /user/orders-history?userId={userId}
* Принимает id пользователя, а на выходе выдает историю его транзакций в формате CSV.

### Доп. Задание 3: Месячный отчет по каждой услуге компании
* Также реализовал метод для получения месячного отчета по каждой услуге компании

* GET /operation/monthly-product-report?companyId={companyId}
* На входе метод принимает id компании.
* На выходе генерируется CSV файл со сводным отчетом по всем услугам компании с указанием сумм выручки по каждой из предоставленной услуги для расчета и уплаты налогов.

## Были покрыты тестами основные методы связанные с транзакциями, резервированием/разрезервированием средств
### При написании тестов использовал JUnit5, Mockito и AssertJ

## Была подключена Swagger2 документация к API 
## Был реализован сценарий разрезервирования денег, если услугу применить не удалось или при отмене услуги.

* POST /operation/un-reserving?orderId={orderId}
* Принимает id заказа для отмены услуги, если услуга не была еще применена
